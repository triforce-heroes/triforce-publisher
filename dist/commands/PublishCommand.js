import{existsSync as e,readFileSync as r,writeFileSync as s}from"node:fs";import{fatal as o}from"@triforce-heroes/triforce-core/Console";function t(e){return"number"==typeof e?e:`'${e.replace(/'/g,"''")}'`}export function PublishCommand(){e("./publishable.json")||o("No publishable.ts found"),process.stdout.write("Reading publishable entries... ");let i=JSON.parse(r("./publishable.json","utf8"));process.stdout.write("OK\n");let n=["INSERT INTO [entries] ([project], [index], [resource], [reference], [sources]) VALUES"];for(let e of i){let r=Number(e.index),s=t(e.resource),o=t(e.reference),i=t(JSON.stringify(e.sources));n.push(`(2, ${r}, ${s}, ${o}, ${i}),`)}s("./publishable-queries.sql",n.join("\n	").slice(0,-1)),process.stdout.write("\nDONE!\n")}