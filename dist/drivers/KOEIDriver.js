import{basename as e}from"node:path";import{validate as r}from"@triforce-heroes/triforce-koei";import{transpile as t}from"@triforce-heroes/triforce-koei/Transpile";import{meta as o}from"../metas/HWAC.js";import{Driver as s}from"./Driver.js";export const KOEIDriver=new class extends s{constructor(){super("koei","*.koei")}validate(e){return r(e)}resourceEntries(r,o){let[s]=e(r).slice(0,-5).split("_",3);return t(o).map((e,r)=>({resource:s,reference:String(r),source:e[0]}))}reassignLocales(e){let r=Object.fromEntries(o.locales.map(e=>[e,[]])),t=Object.groupBy(e,e=>e.resource);for(let e of o.profiles){if("S"===e[0]){let s=0,i=String(e[1]).padStart(4,"0"),[,a]=e,[,,c]=e;for(;s<o.locales.length;){let e=o.locales[s++],l=t[String(a++).padStart(4,"0")];r[e].push(...l.map(e=>({...e,resource:i}))),Object.hasOwn(c,e)&&r[o.locales[s++]].push(...l.map(e=>({...e,resource:i})))}continue}let[,s,i,a]=e;for(let e=s;e<=i;e++)for(let[s,i]of o.locales.entries()){let o=String(e).padStart(4,"0"),c=String(e+a*s).padStart(4,"0");r[i].push(...t[c].map(e=>({...e,resource:o})))}}return r}};