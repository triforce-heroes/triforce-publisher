import{basename as r}from"node:path";import{validate as e}from"@triforce-heroes/triforce-koei";import{transpile as t}from"@triforce-heroes/triforce-koei/Transpile";import{meta as o}from"../metas/HWAC.js";import{Driver as s}from"./Driver.js";export const KOEIDriver=new class extends s{constructor(){super("koei","*.koei")}validate(r){return e(r)}resourceEntries(e,o){let[s]=r(e).slice(0,-5).split("_",3);return t(o)[1].map((r,e)=>({resource:s,reference:String(e),source:r[0].toString()}))}reassignLocales(r){let e=Object.fromEntries(o.locales.map(r=>[r,[]])),t=Object.groupBy(r,r=>r.resource);for(let r of o.profiles){if("S"===r[0]){let s=0,i=String(r[1]).padStart(4,"0"),[,a]=r,[,,c]=r;for(;s<o.locales.length;){let r=o.locales[s++],l=t[String(a++).padStart(4,"0")];e[r].push(...l.map(r=>({...r,resource:i}))),Object.hasOwn(c,r)&&e[o.locales[s++]].push(...l.map(r=>({...r,resource:i})))}continue}let[,s,i,a]=r;for(let r=s;r<=i;r++)for(let[s,i]of o.locales.entries()){let o=String(r).padStart(4,"0"),c=String(r+a*s).padStart(4,"0");e[i].push(...t[c].map(r=>({...r,resource:o})))}}return e}};